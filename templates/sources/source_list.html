{% extends 'home.html' %}

{% block source-name %}{% endblock %}

{% block source-description %}
<div class="p-3 bg-purple-50 border border-purple-200 rounded">
    <p class="text-sm font-semibold text-purple-800 mb-2">ğŸ“ è‡ªå»ºè³‡æ–™æº</p>
    <p class="text-xs text-purple-600 mb-2">
        å»ºç«‹å’Œç®¡ç†æ‚¨çš„ç§æœ‰è³‡æ–™åº«ï¼Œä¸Šå‚³æ–‡ä»¶ä¸¦é€²è¡Œæ™ºæ…§å°è©±ã€‚
    </p>
    {% if not has_unlimited_source %}
        <div class="text-xs text-purple-700 bg-purple-100 rounded px-2 py-1">
            ğŸ“Š å·²å»ºç«‹ï¼š{{ private_source_count }}/{{ private_source_limit }} å€‹è³‡æ–™æº
        </div>
    {% else %}
        <div class="text-xs text-purple-700 bg-purple-100 rounded px-2 py-1">
            âœ¨ ç„¡é™åˆ¶å»ºç«‹è³‡æ–™æº
        </div>
    {% endif %}
</div>
{% endblock %}

{% block filter_section %}
    <!-- æ“ä½œæŒ‰éˆ•å€ -->
    <div class="flex flex-wrap gap-2 mb-4">
        {% if can_create_source %}
            <a href="{% url 'source_create' %}" class="btn btn-primary">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                å»ºç«‹æ–°è³‡æ–™æº
            </a>
        {% else %}
            <button class="btn btn-primary btn-disabled" title="å·²é”åˆ°è³‡æ–™æºæ•¸é‡ä¸Šé™">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                å»ºç«‹æ–°è³‡æ–™æº (å·²é”ä¸Šé™)
            </button>
        {% endif %}
    </div>

    <!-- é™åˆ¶è­¦å‘Š -->
    {% if not has_unlimited_source and private_source_count >= private_source_limit %}
        <div class="alert alert-warning mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.08 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
            <div>
                <h3 class="font-bold">å·²é”åˆ°è³‡æ–™æºæ•¸é‡ä¸Šé™</h3>
                <div class="text-xs">æ‚¨å·²å»ºç«‹ {{ private_source_count }} å€‹è³‡æ–™æºï¼Œå·²é”åˆ°ä¸Šé™ï¼ˆ{{ private_source_limit }} å€‹ï¼‰ã€‚å¦‚éœ€å»ºç«‹æ›´å¤šè³‡æ–™æºï¼Œè«‹åˆªé™¤ç¾æœ‰è³‡æ–™æºæˆ–è¯ç¹«ç®¡ç†å“¡ã€‚</div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block data-table %}
    <div class="data-table h-full overflow-y-auto pr-2 space-y-4">
        <!-- é¡¯ç¤ºè¨Šæ¯ -->
        {% if messages %}
            <div class="mb-4 space-y-2">
                {% for message in messages %}
                    <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% else %}alert-info{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% if sources %}
            {% for source in sources %}
                <div class="card shadow-md bg-white p-4 border border-gray-200 hover:shadow-lg hover:border-purple-300 transition-all duration-200">
                    <div class="flex justify-between items-start">
                        <!-- å·¦å´å…§å®¹å€åŸŸ -->
                        <div class="flex-1 space-y-2 text-sm text-gray-800 mr-4">
                            <div class="flex items-center">
                                <span class="font-semibold text-lg text-purple-700">{{ source.name }}</span>
                                <span class="badge badge-primary badge-sm ml-2">{{ source.file_count }} å€‹æª”æ¡ˆ</span>
                            </div>
                            <div><span class="font-semibold">æè¿°ï¼š</span>{{ source.description }}</div>
                            <div><span class="font-semibold">å»ºç«‹æ™‚é–“ï¼š</span>{{ source.created_at|date:"Y-m-d H:i" }}</div>
                        </div>
                        
                        <!-- å³å´æŒ‰éˆ•å€åŸŸ -->
                        <div class="flex flex-col space-y-2 min-w-fit">
                            <a href="{% url 'source_detail' source.id %}" class="btn btn-sm btn-outline btn-primary">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                æŸ¥çœ‹è©³æƒ…
                            </a>
                            <button class="btn btn-sm btn-outline btn-success add-reference-btn"
                                    data-id="{{ source.id }}"
                                    data-name="{{ source.name }}"
                                    data-description="{{ source.description }}"
                                    data-file-count="{{ source.file_count }}"
                                    data-created-at="{{ source.created_at|date:'Y-m-d H:i' }}">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                åŠ å…¥å°è©±
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="card shadow-md bg-white p-4 border border-gray-200">
                <div class="text-center space-y-4">
                    <div class="text-6xl text-gray-300">ğŸ“</div>
                    <div class="space-y-2">
                        <div class="text-gray-500 font-medium">é‚„æ²’æœ‰ä»»ä½•è‡ªå»ºè³‡æ–™æº</div>
                        {% if can_create_source %}
                            <div class="text-sm text-gray-400">é»æ“Šä¸Šæ–¹ã€Œå»ºç«‹æ–°è³‡æ–™æºã€æŒ‰éˆ•é–‹å§‹å»ºç«‹æ‚¨çš„ç¬¬ä¸€å€‹è³‡æ–™æº</div>
                        {% else %}
                            <div class="text-sm text-red-500">æ‚¨å·²é”åˆ°è³‡æ–™æºæ•¸é‡ä¸Šé™ï¼ˆ{{ private_source_limit }} å€‹ï¼‰ï¼Œç„¡æ³•å»ºç«‹æ–°çš„è³‡æ–™æº</div>
                        {% endif %}
                    </div>
                    {% if can_create_source %}
                        <div>
                            <a href="{% url 'source_create' %}" class="btn btn-primary">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                å»ºç«‹æ–°è³‡æ–™æº
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
{% endblock %} 